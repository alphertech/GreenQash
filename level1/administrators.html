<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkyLink Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* ========== BASE STYLES ========== */
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --sidebar-width: 260px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* ========== LOADING OVERLAY ========== */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== HEADER ========== */
        .header {
            background: white;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--secondary);
        }

        .logo span {
            color: var(--primary);
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            color: var(--secondary);
            cursor: pointer;
            padding: 5px;
        }

        /* Admin Controls */
        .admin-controls {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--info));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }

        .logout-btn {
            padding: 8px 20px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        /* ========== MAIN LAYOUT ========== */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
            margin-top: 70px;
        }

        /* ========== SIDEBAR ========== */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--secondary);
            color: white;
            position: fixed;
            top: 70px;
            left: 0;
            bottom: 0;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 99;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background: var(--primary);
            border-left-color: var(--warning);
        }

        .menu-item i {
            width: 20px;
            text-align: center;
            font-size: 18px;
        }

        .menu-item span {
            font-size: 15px;
            font-weight: 500;
        }

        /* ========== CONTENT AREA ========== */
        .content-area {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 30px;
            transition: margin-left 0.3s ease;
        }

        /* ========== MOBILE OVERLAY ========== */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 70px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 98;
        }

        /* ========== DASHBOARD CARDS ========== */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
        }

        .stat-card:nth-child(2) { border-top-color: var(--success); }
        .stat-card:nth-child(3) { border-top-color: var(--warning); }
        .stat-card:nth-child(4) { border-top-color: var(--danger); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stat-title {
            font-size: 16px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: white;
            background: var(--primary);
        }

        .stat-card:nth-child(2) .stat-icon { background: var(--success); }
        .stat-card:nth-child(3) .stat-icon { background: var(--warning); }
        .stat-card:nth-child(4) .stat-icon { background: var(--danger); }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--secondary);
            margin: 10px 0;
        }

        .stat-change {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .change-up { color: var(--success); }
        .change-down { color: var(--danger); }

        /* ========== TABLES ========== */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .table-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 20px;
            color: var(--secondary);
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8f9fa;
        }

        th {
            padding: 18px 25px;
            text-align: left;
            font-weight: 600;
            color: var(--secondary);
            border-bottom: 2px solid #eee;
            white-space: nowrap;
        }

        td {
            padding: 18px 25px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        /* ========== STATUS BADGES ========== */
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .status-approved { background: #d1ecf1; color: #0c5460; }
        .status-paid { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #27ae60;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 13px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            justify-content: center;
        }

        /* ========== ACTION BUTTONS ========== */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        /* ========== FORMS ========== */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        /* ========== MODALS ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            color: var(--secondary);
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            line-height: 1;
            padding: 5px;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* ========== POST CARDS ========== */
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            padding: 25px;
        }

        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        }

        .post-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(45deg, var(--primary), var(--info));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }

        .post-content {
            padding: 25px;
        }

        .post-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .post-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            color: #666;
            font-size: 14px;
        }

        .post-meta i {
            margin-right: 5px;
        }

        .post-type {
            display: inline-block;
            padding: 4px 12px;
            background: var(--primary);
            color: white;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .post-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* ========== NOTIFICATIONS ========== */
        .notification-container {
            position: fixed;
            top: 100px;
            right: 30px;
            z-index: 1001;
        }

        .notification {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            animation: slideInRight 0.3s;
            border-left: 4px solid var(--primary);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification-success {
            border-left-color: var(--success);
        }

        .notification-error {
            border-left-color: var(--danger);
        }

        .notification-warning {
            border-left-color: var(--warning);
        }

        .notification-icon {
            font-size: 20px;
        }

        .notification-success .notification-icon { color: var(--success); }
        .notification-error .notification-icon { color: var(--danger); }
        .notification-warning .notification-icon { color: var(--warning); }

        /* ========== FILTERS ========== */
        .filters {
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-size: 13px;
            font-weight: 500;
            color: #666;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            min-width: 180px;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 1200px) {
            .dashboard-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .posts-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .content-area {
                margin-left: 0;
                padding: 20px;
            }
            
            .mobile-overlay.active {
                display: block;
            }
            
            .menu-toggle {
                display: block;
            }
            
            .header {
                padding: 0 20px;
            }
            
            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .section-actions {
                justify-content: flex-start;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .posts-grid {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            table {
                min-width: 800px;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group select,
            .filter-group input {
                min-width: auto;
                width: 100%;
            }
            
            .notification {
                min-width: auto;
                width: calc(100vw - 60px);
                right: 20px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 15px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .admin-controls {
                gap: 10px;
            }
            
            .logout-btn span {
                display: none;
            }
            
            .logout-btn {
                padding: 10px;
                width: 40px;
                height: 40px;
                justify-content: center;
            }
            
            .content-area {
                padding: 15px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            .btn {
                padding: 8px 15px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <h1>Sky<span>Admin</span></h1>
            </div>
        </div>
        
        <div class="admin-controls">
            <div class="admin-avatar" id="adminAvatar">
                A
            </div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </button>
        </div>
    </header>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobileOverlay"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </li>
                <li class="menu-item" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Users</span>
                </li>
                <li class="menu-item" data-section="posts">
                    <i class="fas fa-newspaper"></i>
                    <span>Post Management</span>
                </li>
                <li class="menu-item" data-section="earnings">
                    <i class="fas fa-chart-line"></i>
                    <span>Earnings</span>
                </li>
                <li class="menu-item" data-section="withdrawals">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Withdrawals</span>
                </li>
                <li class="menu-item" data-section="referrals">
                    <i class="fas fa-network-wired"></i>
                    <span>Referrals</span>
                </li>
                <li class="menu-item" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </li>
            </ul>
        </nav>

        <!-- Content Area -->
        <main class="content-area" id="contentArea">
            <!-- Dashboard Section -->
            <section class="section active" id="dashboardSection">
                <div class="dashboard-cards">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Total Users</div>
                                <div class="stat-value" id="totalUsers">0</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="stat-change change-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>Active users</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Total Earnings</div>
                                <div class="stat-value" id="totalEarnings">UGX 0</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="stat-change change-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>Growing steadily</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Pending Withdrawals</div>
                                <div class="stat-value" id="pendingWithdrawals">UGX 0</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                        </div>
                        <div class="stat-change change-down">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Require action</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div>
                                <div class="stat-title">Active Posts</div>
                                <div class="stat-value" id="activePosts">0</div>
                            </div>
                            <div class="stat-icon">
                                <i class="fas fa-newspaper"></i>
                            </div>
                        </div>
                        <div class="stat-change change-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>Content active</span>
                        </div>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Recent Activity</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" id="refreshActivity">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activityTable">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    Loading activities...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Section -->
            <section class="section" id="usersSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">User Management</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" id="addUserBtn">
                                <i class="fas fa-user-plus"></i> Add User
                            </button>
                            <button class="btn btn-success" id="exportUsersBtn">
                                <i class="fas fa-download"></i> Export
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label>Search Users</label>
                            <input type="text" id="userSearch" placeholder="Search by name, email..." class="form-control">
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="userStatusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Balance</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    Loading users...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Posts Management Section -->
            <section class="section" id="postsSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Post Management</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" id="createPostBtn">
                                <i class="fas fa-plus"></i> Create Post
                            </button>
                            <button class="btn btn-success" id="refreshPostsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label>Post Type</label>
                            <select id="postTypeFilter">
                                <option value="">All Types</option>
                                <option value="youtube">YouTube</option>
                                <option value="tiktok">TikTok</option>
                                <option value="trivia">Trivia</option>
                                <option value="announcement">Announcement</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="postStatusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="posts-grid" id="postsGrid">
                        <!-- Posts will be loaded here -->
                        <div class="post-card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                            <i class="fas fa-newspaper" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                            <h3>Loading posts...</h3>
                            <p>Posts will appear here once loaded</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Earnings Section -->
            <section class="section" id="earningsSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Earnings Overview</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" id="refreshEarningsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>YouTube</th>
                                <th>TikTok</th>
                                <th>Trivia</th>
                                <th>Referral</th>
                                <th>Total</th>
                                <th>Withdrawn</th>
                                <th>Available</th>
                            </tr>
                        </thead>
                        <tbody id="earningsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px;">
                                    Loading earnings data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Withdrawals Section -->
            <section class="section" id="withdrawalsSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Withdrawal Requests</h2>
                        <div class="section-actions">
                            <button class="btn btn-success" id="processWithdrawalsBtn">
                                <i class="fas fa-check-circle"></i> Process Selected
                            </button>
                            <button class="btn btn-primary" id="refreshWithdrawalsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label>Status</label>
                            <select id="withdrawalStatusFilter">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="processing">Processing</option>
                                <option value="paid">Paid</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Payment Method</label>
                            <select id="withdrawalMethodFilter">
                                <option value="">All Methods</option>
                                <option value="mobile_money">Mobile Money</option>
                                <option value="bank">Bank Transfer</option>
                            </select>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllWithdrawals"></th>
                                <th>Request ID</th>
                                <th>User</th>
                                <th>Amount</th>
                                <th>Method</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="withdrawalsTable">
                            <tr>
                                <td colspan="8" style="text-align: center; padding: 40px;">
                                    Loading withdrawal requests...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Referrals Section -->
            <section class="section" id="referralsSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">Referral Network</h2>
                        <div class="section-actions">
                            <button class="btn btn-primary" id="refreshReferralsBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Inviter</th>
                                <th>Referred User</th>
                                <th>Level</th>
                                <th>Earnings</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="referralsTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    Loading referral data...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="section" id="settingsSection">
                <div class="table-container">
                    <div class="table-header">
                        <h2 class="table-title">System Settings</h2>
                        <div class="section-actions">
                            <button class="btn btn-success" id="saveSettingsBtn">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                        </div>
                    </div>
                    
                    <div style="padding: 30px;">
                        <form id="settingsForm">
                            <div class="form-group">
                                <label class="form-label">Site Name</label>
                                <input type="text" class="form-control" id="siteName" value="SkyLink">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Minimum Withdrawal Amount (UGX)</label>
                                <input type="number" class="form-control" id="minWithdrawal" value="59000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Referral Bonus - Level 1 (UGX)</label>
                                <input type="number" class="form-control" id="referralL1" value="7000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Referral Bonus - Level 2 (UGX)</label>
                                <input type="number" class="form-control" id="referralL2" value="4000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Task Reward Amount (UGX)</label>
                                <input type="number" class="form-control" id="taskReward" value="250">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="enableEmailNotifications" checked>
                                    Enable Email Notifications
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="maintenanceMode">
                                    Maintenance Mode
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <!-- User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New User</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Initial Balance (UGX)</label>
                        <input type="number" class="form-control" id="balance" value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="status">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelUserBtn">Cancel</button>
                <button class="btn btn-primary" id="saveUserBtn">Save User</button>
            </div>
        </div>
    </div>

    <!-- Post Modal -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Post</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="postForm">
                    <div class="form-group">
                        <label class="form-label">Post Title *</label>
                        <input type="text" class="form-control" id="postTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Post Type *</label>
                        <select class="form-control" id="postType" required>
                            <option value="youtube">YouTube</option>
                            <option value="tiktok">TikTok</option>
                            <option value="trivia">Trivia</option>
                            <option value="announcement">Announcement</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Content *</label>
                        <textarea class="form-control" id="postContent" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Image URL</label>
                        <input type="url" class="form-control" id="postImage" placeholder="https://example.com/image.jpg">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reward Amount (UGX)</label>
                        <input type="number" class="form-control" id="postReward" value="250">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" id="cancelPostBtn">Cancel</button>
                <button class="btn btn-primary" id="savePostBtn">Create Post</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <script>
        // Configuration
        const SUPABASE_URL = 'https://kwghulqonljulmvlcfnz.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3Z2h1bHFvbmxqdWxtdmxjZm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5NzcyMDcsImV4cCI6MjA3OTU1MzIwN30.hebcPqAvo4B23kx4gdWuXTJhmx7p8zSHHEYSkPzPhcM';

        // Global variables
        let supabase = null;
        let currentUser = null;
        let selectedWithdrawals = [];

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Admin Dashboard Loading...');
            initializeApp();
        });

        async function initializeApp() {
            try {
                // Show loading overlay
                showLoading();
                
                // Initialize Supabase
                supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                console.log('Supabase initialized');
                
                // Check authentication
                const { data: { user }, error: authError } = await supabase.auth.getUser();
                
                if (authError) {
                    console.error('Auth error:', authError);
                    showNotification('Authentication error', 'error');
                    redirectToLogin();
                    return;
                }
                
                if (!user) {
                    console.log('No user, redirecting to login');
                    redirectToLogin();
                    return;
                }
                
                currentUser = user;
                console.log('User authenticated:', user.email);
                
                // Update admin avatar
                document.getElementById('adminAvatar').textContent = 
                    user.email ? user.email.charAt(0).toUpperCase() : 'A';
                
                // Setup event listeners
                setupEventListeners();
                console.log('Event listeners setup');
                
                // Load initial dashboard data
                await loadDashboardData();
                console.log('Dashboard data loaded');
                
                // Hide loading
                hideLoading();
                
            } catch (error) {
                console.error('Initialization error:', error);
                showNotification('Error initializing application', 'error');
                hideLoading();
            }
        }

        function setupEventListeners() {
            console.log('Setting up event listeners...');
            
            // Mobile menu toggle
            document.getElementById('menuToggle').addEventListener('click', toggleMobileMenu);
            document.getElementById('mobileOverlay').addEventListener('click', closeMobileMenu);
            
            // Sidebar navigation
            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const section = this.dataset.section;
                    switchSection(section);
                    closeMobileMenu();
                });
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', closeAllModals);
            });
            
            // User management
            document.getElementById('addUserBtn').addEventListener('click', showUserModal);
            document.getElementById('cancelUserBtn').addEventListener('click', closeAllModals);
            document.getElementById('saveUserBtn').addEventListener('click', saveUser);
            
            // Post management
            document.getElementById('createPostBtn').addEventListener('click', showPostModal);
            document.getElementById('cancelPostBtn').addEventListener('click', closeAllModals);
            document.getElementById('savePostBtn').addEventListener('click', savePost);
            document.getElementById('refreshPostsBtn').addEventListener('click', loadPosts);
            
            // Withdrawal management
            document.getElementById('processWithdrawalsBtn').addEventListener('click', processSelectedWithdrawals);
            document.getElementById('refreshWithdrawalsBtn').addEventListener('click', loadWithdrawals);
            document.getElementById('selectAllWithdrawals').addEventListener('change', toggleSelectAllWithdrawals);
            
            // Search
            document.getElementById('userSearch').addEventListener('input', searchUsers);
            
            // Refresh buttons
            document.getElementById('refreshActivity').addEventListener('click', loadDashboardData);
            document.getElementById('refreshEarningsBtn').addEventListener('click', loadEarnings);
            document.getElementById('refreshReferralsBtn').addEventListener('click', loadReferrals);
            
            // Settings
            document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
            
            // Filter changes
            document.getElementById('userStatusFilter').addEventListener('change', loadUsers);
            document.getElementById('postTypeFilter').addEventListener('change', loadPosts);
            document.getElementById('postStatusFilter').addEventListener('change', loadPosts);
            document.getElementById('withdrawalStatusFilter').addEventListener('change', loadWithdrawals);
            document.getElementById('withdrawalMethodFilter').addEventListener('change', loadWithdrawals);
            
            console.log('Event listeners setup complete');
        }

        function toggleMobileMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('mobileOverlay').classList.toggle('active');
        }

        function closeMobileMenu() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('mobileOverlay').classList.remove('active');
        }

        function switchSection(section) {
            console.log('Switching to section:', section);
            
            // Update menu
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === section) {
                    item.classList.add('active');
                }
            });
            
            // Update sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            const sectionElement = document.getElementById(section + 'Section');
            if (sectionElement) {
                sectionElement.classList.add('active');
            }
            
            // Load section data
            loadSectionData(section);
        }

        async function loadSectionData(section) {
            console.log('Loading section data for:', section);
            
            try {
                switch (section) {
                    case 'dashboard':
                        await loadDashboardData();
                        break;
                    case 'users':
                        await loadUsers();
                        break;
                    case 'posts':
                        await loadPosts();
                        break;
                    case 'earnings':
                        await loadEarnings();
                        break;
                    case 'withdrawals':
                        await loadWithdrawals();
                        break;
                    case 'referrals':
                        await loadReferrals();
                        break;
                    case 'settings':
                        // Settings form is already loaded
                        break;
                }
            } catch (error) {
                console.error('Error loading section data:', error);
                showNotification('Error loading section data', 'error');
            }
        }

        async function loadDashboardData() {
            try {
                // Mock data for demonstration
                // In production, you would fetch from Supabase
                
                // Update stats
                document.getElementById('totalUsers').textContent = '1,248';
                document.getElementById('totalEarnings').textContent = 'UGX 15,780,000';
                document.getElementById('pendingWithdrawals').textContent = 'UGX 2,450,000';
                document.getElementById('activePosts').textContent = '47';
                
                // Update activity table
                const activities = [
                    {
                        time: new Date().toLocaleTimeString(),
                        user: 'John Doe',
                        action: 'Completed TikTok Task',
                        details: 'Earned UGX 250',
                        status: 'success'
                    },
                    {
                        time: new Date().toLocaleTimeString(),
                        user: 'Jane Smith',
                        action: 'Withdrawal Request',
                        details: 'Requested UGX 62,000',
                        status: 'pending'
                    },
                    {
                        time: new Date().toLocaleTimeString(),
                        user: 'Mike Johnson',
                        action: 'Referred New User',
                        details: 'Earned UGX 7,000',
                        status: 'success'
                    },
                    {
                        time: new Date().toLocaleTimeString(),
                        user: 'Sarah Williams',
                        action: 'Completed Trivia',
                        details: 'Earned UGX 1,200',
                        status: 'success'
                    }
                ];
                
                updateActivityTable(activities);
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading dashboard data', 'error');
            }
        }

        function updateActivityTable(activities) {
            const tbody = document.getElementById('activityTable');
            
            if (!activities || activities.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            No recent activity
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            activities.forEach(activity => {
                const statusClass = activity.status === 'success' ? 'status-active' : 'status-pending';
                
                html += `
                    <tr>
                        <td>${activity.time}</td>
                        <td>${activity.user}</td>
                        <td>${activity.action}</td>
                        <td>${activity.details}</td>
                        <td><span class="status-badge ${statusClass}">${activity.status}</span></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        async function loadUsers() {
            try {
                const searchTerm = document.getElementById('userSearch').value;
                const statusFilter = document.getElementById('userStatusFilter').value;
                
                // Mock users data
                const users = [
                    {
                        id: 1,
                        username: 'john_doe',
                        email: 'john@example.com',
                        status: 'active',
                        balance: 15000,
                        joined: '2024-01-15'
                    },
                    {
                        id: 2,
                        username: 'jane_smith',
                        email: 'jane@example.com',
                        status: 'active',
                        balance: 75000,
                        joined: '2024-01-10'
                    },
                    {
                        id: 3,
                        username: 'mike_johnson',
                        email: 'mike@example.com',
                        status: 'pending',
                        balance: 5000,
                        joined: '2024-01-20'
                    },
                    {
                        id: 4,
                        username: 'sarah_williams',
                        email: 'sarah@example.com',
                        status: 'active',
                        balance: 120000,
                        joined: '2024-01-05'
                    }
                ];
                
                // Filter users
                let filteredUsers = users;
                
                if (searchTerm) {
                    const term = searchTerm.toLowerCase();
                    filteredUsers = filteredUsers.filter(user => 
                        user.username.toLowerCase().includes(term) ||
                        user.email.toLowerCase().includes(term)
                    );
                }
                
                if (statusFilter) {
                    filteredUsers = filteredUsers.filter(user => user.status === statusFilter);
                }
                
                updateUsersTable(filteredUsers);
                
            } catch (error) {
                console.error('Error loading users:', error);
                showNotification('Error loading users', 'error');
            }
        }

        function updateUsersTable(users) {
            const tbody = document.getElementById('usersTable');
            
            if (!users.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px;">
                            No users found
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            users.forEach(user => {
                const statusClass = `status-${user.status}`;
                const joined = new Date(user.joined).toLocaleDateString();
                
                html += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td><span class="status-badge ${statusClass}">${user.status}</span></td>
                        <td>UGX ${user.balance.toLocaleString()}</td>
                        <td>${joined}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-icon btn-sm btn-primary" onclick="editUser(${user.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-icon btn-sm btn-danger" onclick="deleteUser(${user.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        function searchUsers() {
            loadUsers();
        }

        function showUserModal() {
            document.getElementById('userModal').style.display = 'flex';
        }

        async function saveUser() {
            const username = document.getElementById('username').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const balance = document.getElementById('balance').value;
            const status = document.getElementById('status').value;
            
            if (!username || !email || !password) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }
            
            try {
                showLoading();
                
                // In production, this would save to Supabase
                // For demo, we'll just show success
                
                setTimeout(() => {
                    showNotification('User created successfully', 'success');
                    closeAllModals();
                    loadUsers();
                    hideLoading();
                }, 1000);
                
            } catch (error) {
                console.error('Error creating user:', error);
                showNotification('Error creating user', 'error');
                hideLoading();
            }
        }

        async function loadPosts() {
            try {
                const typeFilter = document.getElementById('postTypeFilter').value;
                const statusFilter = document.getElementById('postStatusFilter').value;
                
                // Mock posts data
                const posts = [
                    {
                        id: 1,
                        title: 'Watch This Amazing TikTok Video',
                        type: 'tiktok',
                        content: 'Like and share this video for UGX 250 reward',
                        image: 'https://images.unsplash.com/photo-1611605698323-b1e99cfd37ea?w=400&h=200&fit=crop',
                        reward: 250,
                        status: 'active',
                        date: '2024-01-20'
                    },
                    {
                        id: 2,
                        title: 'Subscribe to Our YouTube Channel',
                        type: 'youtube',
                        content: 'Subscribe and watch our latest videos',
                        image: 'https://images.unsplash.com/photo-1499364615650-ec38552f4f34?w=400&h=200&fit=crop',
                        reward: 250,
                        status: 'active',
                        date: '2024-01-19'
                    },
                    {
                        id: 3,
                        title: 'Daily Trivia Challenge',
                        type: 'trivia',
                        content: 'Answer 5 questions correctly to earn UGX 1,200',
                        image: 'https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=400&h=200&fit=crop',
                        reward: 1200,
                        status: 'active',
                        date: '2024-01-20'
                    },
                    {
                        id: 4,
                        title: 'System Maintenance Notice',
                        type: 'announcement',
                        content: 'System will be down for maintenance on Sunday',
                        image: 'https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=400&h=200&fit=crop',
                        reward: 0,
                        status: 'active',
                        date: '2024-01-18'
                    }
                ];
                
                // Filter posts
                let filteredPosts = posts;
                
                if (typeFilter) {
                    filteredPosts = filteredPosts.filter(post => post.type === typeFilter);
                }
                
                if (statusFilter) {
                    filteredPosts = filteredPosts.filter(post => post.status === statusFilter);
                }
                
                updatePostsGrid(filteredPosts);
                
            } catch (error) {
                console.error('Error loading posts:', error);
                showNotification('Error loading posts', 'error');
            }
        }

        function updatePostsGrid(posts) {
            const container = document.getElementById('postsGrid');
            
            if (!posts.length) {
                container.innerHTML = `
                    <div class="post-card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <i class="fas fa-newspaper" style="font-size: 48px; color: #ccc; margin-bottom: 20px;"></i>
                        <h3>No posts found</h3>
                        <p>Create your first post or adjust your filters</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            posts.forEach(post => {
                const typeColors = {
                    'youtube': '#FF0000',
                    'tiktok': '#000000',
                    'trivia': '#2ecc71',
                    'announcement': '#3498db'
                };
                
                const date = new Date(post.date).toLocaleDateString();
                
                html += `
                    <div class="post-card">
                        <div class="post-image" style="background: ${typeColors[post.type] || '#3498db'};">
                            ${post.type === 'youtube' ? '<i class="fab fa-youtube"></i>' : 
                              post.type === 'tiktok' ? '<i class="fab fa-tiktok"></i>' :
                              post.type === 'trivia' ? '<i class="fas fa-brain"></i>' :
                              '<i class="fas fa-bullhorn"></i>'}
                        </div>
                        <div class="post-content">
                            <h3 class="post-title">${post.title}</h3>
                            <div class="post-meta">
                                <span><i class="fas fa-tag"></i> <span class="post-type">${post.type}</span></span>
                                <span><i class="fas fa-calendar"></i> ${date}</span>
                                <span><i class="fas fa-money-bill-wave"></i> UGX ${post.reward}</span>
                            </div>
                            <p>${post.content}</p>
                            <div class="post-actions">
                                <button class="btn btn-sm btn-primary" onclick="editPost(${post.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deletePost(${post.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function showPostModal() {
            document.getElementById('postModal').style.display = 'flex';
        }

        async function savePost() {
            const title = document.getElementById('postTitle').value;
            const type = document.getElementById('postType').value;
            const content = document.getElementById('postContent').value;
            const image = document.getElementById('postImage').value;
            const reward = document.getElementById('postReward').value;
            
            if (!title || !type || !content) {
                showNotification('Please fill in all required fields', 'warning');
                return;
            }
            
            try {
                showLoading();
                
                // In production, this would save to Supabase
                // For demo, we'll just show success
                
                setTimeout(() => {
                    showNotification('Post created successfully', 'success');
                    closeAllModals();
                    loadPosts();
                    hideLoading();
                }, 1000);
                
            } catch (error) {
                console.error('Error creating post:', error);
                showNotification('Error creating post', 'error');
                hideLoading();
            }
        }

        async function loadEarnings() {
            try {
                // Mock earnings data
                const earnings = [
                    {
                        user: 'John Doe',
                        youtube: 1500,
                        tiktok: 3000,
                        trivia: 1200,
                        referral: 7000,
                        total: 12700,
                        withdrawn: 5000,
                        available: 7700
                    },
                    {
                        user: 'Jane Smith',
                        youtube: 2500,
                        tiktok: 1500,
                        trivia: 2400,
                        referral: 21000,
                        total: 27400,
                        withdrawn: 15000,
                        available: 12400
                    },
                    {
                        user: 'Mike Johnson',
                        youtube: 500,
                        tiktok: 1000,
                        trivia: 600,
                        referral: 0,
                        total: 2100,
                        withdrawn: 0,
                        available: 2100
                    }
                ];
                
                updateEarningsTable(earnings);
                
            } catch (error) {
                console.error('Error loading earnings:', error);
                showNotification('Error loading earnings', 'error');
            }
        }

        function updateEarningsTable(earnings) {
            const tbody = document.getElementById('earningsTable');
            
            if (!earnings.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            No earnings data found
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            earnings.forEach(earning => {
                html += `
                    <tr>
                        <td>${earning.user}</td>
                        <td>UGX ${earning.youtube.toLocaleString()}</td>
                        <td>UGX ${earning.tiktok.toLocaleString()}</td>
                        <td>UGX ${earning.trivia.toLocaleString()}</td>
                        <td>UGX ${earning.referral.toLocaleString()}</td>
                        <td><strong>UGX ${earning.total.toLocaleString()}</strong></td>
                        <td>UGX ${earning.withdrawn.toLocaleString()}</td>
                        <td>UGX ${earning.available.toLocaleString()}</td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        async function loadWithdrawals() {
            try {
                const statusFilter = document.getElementById('withdrawalStatusFilter').value;
                const methodFilter = document.getElementById('withdrawalMethodFilter').value;
                
                // Mock withdrawals data
                const withdrawals = [
                    {
                        id: 'WD001',
                        user: 'John Doe',
                        amount: 62000,
                        method: 'mobile_money',
                        status: 'pending',
                        date: '2024-01-20'
                    },
                    {
                        id: 'WD002',
                        user: 'Jane Smith',
                        amount: 125000,
                        method: 'bank',
                        status: 'approved',
                        date: '2024-01-19'
                    },
                    {
                        id: 'WD003',
                        user: 'Mike Johnson',
                        amount: 59000,
                        method: 'mobile_money',
                        status: 'pending',
                        date: '2024-01-20'
                    },
                    {
                        id: 'WD004',
                        user: 'Sarah Williams',
                        amount: 85000,
                        method: 'mobile_money',
                        status: 'paid',
                        date: '2024-01-18'
                    }
                ];
                
                // Filter withdrawals
                let filteredWithdrawals = withdrawals;
                
                if (statusFilter) {
                    filteredWithdrawals = filteredWithdrawals.filter(w => w.status === statusFilter);
                }
                
                if (methodFilter) {
                    filteredWithdrawals = filteredWithdrawals.filter(w => w.method === methodFilter);
                }
                
                updateWithdrawalsTable(filteredWithdrawals);
                
            } catch (error) {
                console.error('Error loading withdrawals:', error);
                showNotification('Error loading withdrawals', 'error');
            }
        }

        function updateWithdrawalsTable(withdrawals) {
            const tbody = document.getElementById('withdrawalsTable');
            selectedWithdrawals = [];
            
            if (!withdrawals.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px;">
                            No withdrawal requests found
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            withdrawals.forEach(withdrawal => {
                const date = new Date(withdrawal.date).toLocaleDateString();
                const statusClass = `status-${withdrawal.status}`;
                const methodText = withdrawal.method === 'mobile_money' ? 'Mobile Money' : 'Bank Transfer';
                
                html += `
                    <tr>
                        <td>
                            ${withdrawal.status === 'pending' ? `
                                <input type="checkbox" class="withdrawal-checkbox" value="${withdrawal.id}">
                            ` : ''}
                        </td>
                        <td>${withdrawal.id}</td>
                        <td>${withdrawal.user}</td>
                        <td>UGX ${withdrawal.amount.toLocaleString()}</td>
                        <td>${methodText}</td>
                        <td><span class="status-badge ${statusClass}">${withdrawal.status}</span></td>
                        <td>${date}</td>
                        <td>
                            <div class="action-buttons">
                                ${withdrawal.status === 'pending' ? `
                                    <button class="btn btn-icon btn-sm btn-success" onclick="approveWithdrawal('${withdrawal.id}')">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-icon btn-sm btn-danger" onclick="rejectWithdrawal('${withdrawal.id}')">
                                        <i class="fas fa-times"></i>
                                    </button>
                                ` : ''}
                                <button class="btn btn-icon btn-sm btn-primary" onclick="viewWithdrawal('${withdrawal.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Add event listeners to checkboxes
            document.querySelectorAll('.withdrawal-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        selectedWithdrawals.push(this.value);
                    } else {
                        selectedWithdrawals = selectedWithdrawals.filter(id => id !== this.value);
                    }
                    console.log('Selected withdrawals:', selectedWithdrawals);
                });
            });
        }

        function toggleSelectAllWithdrawals() {
            const selectAll = document.getElementById('selectAllWithdrawals');
            const checkboxes = document.querySelectorAll('.withdrawal-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                checkbox.dispatchEvent(new Event('change'));
            });
        }

        function processSelectedWithdrawals() {
            if (selectedWithdrawals.length === 0) {
                showNotification('Please select at least one withdrawal to process', 'warning');
                return;
            }
            
            showNotification(`Processing ${selectedWithdrawals.length} withdrawal(s)`, 'success');
            // In production, you would show a modal for processing
        }

        async function loadReferrals() {
            try {
                // Mock referrals data
                const referrals = [
                    {
                        inviter: 'John Doe',
                        referred: 'Mike Johnson',
                        level: 1,
                        earnings: 7000,
                        date: '2024-01-15',
                        status: 'active'
                    },
                    {
                        inviter: 'Jane Smith',
                        referred: 'Sarah Williams',
                        level: 1,
                        earnings: 7000,
                        date: '2024-01-10',
                        status: 'active'
                    },
                    {
                        inviter: 'John Doe',
                        referred: 'Bob Wilson',
                        level: 2,
                        earnings: 4000,
                        date: '2024-01-18',
                        status: 'active'
                    }
                ];
                
                updateReferralsTable(referrals);
                
            } catch (error) {
                console.error('Error loading referrals:', error);
                showNotification('Error loading referrals', 'error');
            }
        }

        function updateReferralsTable(referrals) {
            const tbody = document.getElementById('referralsTable');
            
            if (!referrals.length) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px;">
                            No referrals found
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            
            referrals.forEach(referral => {
                const date = new Date(referral.date).toLocaleDateString();
                
                html += `
                    <tr>
                        <td>${referral.inviter}</td>
                        <td>${referral.referred}</td>
                        <td>${referral.level}</td>
                        <td>UGX ${referral.earnings.toLocaleString()}</td>
                        <td>${date}</td>
                        <td><span class="status-badge status-active">${referral.status}</span></td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        async function saveSettings() {
            const siteName = document.getElementById('siteName').value;
            const minWithdrawal = document.getElementById('minWithdrawal').value;
            const referralL1 = document.getElementById('referralL1').value;
            const referralL2 = document.getElementById('referralL2').value;
            const taskReward = document.getElementById('taskReward').value;
            
            // In production, save to database
            showNotification('Settings saved successfully', 'success');
        }

        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    <i class="fas fa-${icons[type] || 'info-circle'}"></i>
                </div>
                <div>
                    <strong>${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                    <p style="margin-top: 5px;">${message}</p>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
            
            // Reset forms
            document.getElementById('userForm').reset();
            document.getElementById('postForm').reset();
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function redirectToLogin() {
            window.location.href = '../index.html';
        }

        async function logout() {
            try {
                showLoading();
                if (supabase) {
                    await supabase.auth.signOut();
                }
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1000);
            } catch (error) {
                console.error('Error logging out:', error);
                showNotification('Error logging out', 'error');
                hideLoading();
            }
        }

        // Global functions for buttons
        window.editUser = function(userId) {
            showNotification(`Edit user ${userId} - Feature coming soon`, 'info');
        };

        window.deleteUser = function(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                showNotification('User deleted successfully', 'success');
                loadUsers();
            }
        };

        window.editPost = function(postId) {
            showNotification(`Edit post ${postId} - Feature coming soon`, 'info');
        };

        window.deletePost = function(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                showNotification('Post deleted successfully', 'success');
                loadPosts();
            }
        };

        window.approveWithdrawal = function(requestId) {
            if (confirm('Approve this withdrawal request?')) {
                showNotification(`Withdrawal ${requestId} approved`, 'success');
                loadWithdrawals();
            }
        };

        window.rejectWithdrawal = function(requestId) {
            if (confirm('Reject this withdrawal request?')) {
                showNotification(`Withdrawal ${requestId} rejected`, 'success');
                loadWithdrawals();
            }
        };

        window.viewWithdrawal = function(requestId) {
            showNotification(`Viewing withdrawal ${requestId} - Feature coming soon`, 'info');
        };
    </script>
</body>
</html>